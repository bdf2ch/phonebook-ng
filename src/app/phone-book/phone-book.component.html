<div id="app-header">

    <!-- Заголовок приложения -->
    <div id="title">
        <div class="logo"><i class="fa fa-phone"></i></div>
        <span class="label">Телефонный справочник</span>
    </div>

    <!-- Панель поиска абонентов -->
    <div id="search">
        <!--<div id="search-left"></div>-->
        <div id="search-center">
            <div class="width-100 padding-left-20 padding-right-20 combined-input">
                <i class="fa fa-search"></i>
                <input type="text" name="" id="" placeholder="Введите имя абонента, телефон или e-mail" [(ngModel)]="phoneBook.searchQuery" (keyup)="searchContacts(phoneBook.searchQuery)">
                <i class="fa fa-times clickable" *ngIf="phoneBook.searchQuery.length > 0" (click)="phoneBook.clearSearch()" title="Очистить поиск"></i>
                <i class="fa fa-gear clickable" *ngIf="phoneBook.contacts.length > 0" (click)="openAtsPanel()" title="Выбрать откуда осуществляется звонок"></i>
            </div>
        </div>
        <div id="search-right">
            <!-- Руководство пользователя -->
            <button type="button" class="btn round small margin-right-10" title="Помощь">
                <i class="fa fa-info"></i>
            </button>

            <!-- Избранные контакты -->
            <button type="button"
                    class="btn small round favorites badged"
                    *ngIf="session.user && phoneBook.favorites.contacts.length > 0"
                    [ngClass]="{'active': phoneBook.isInFavoritesMode === true}"
                    (click)="switchToFavorites()"
                    title="Избранные контакты">
                <span class="badge">{{ phoneBook.favorites.contacts.length }}</span>
                <i class="fa fa-star"></i>
                <span class="corner"></span>
            </button>

            <!-- Авторизация пользователя -->
            <button type="button" class="btn small round" (click)="openAuthModal()" title="Войти" *ngIf="session.user === null" title="Авторизация">
                <i class="fa fa-sign-in"></i>
            </button>

            <!-- Меню пользователя -->
            <div class="user-logged" *ngIf="session.user !== null" (click)="openUserMenuModal()"
                 [ngStyle]="{ 'background': session.user.photo !== null ? 'url(http://10.50.4.7:4444' + session.user.photo + ')' : ''}" title="Меню пользователя">
                <span class="initials" *ngIf="session.user.photo === null">{{ session.user.name[0] + session.user.surname[0] }}</span>
            </div>
        </div>
    </div>


</div>
<div id="app-divisions">

    <div id="app-divisions-header">
        <company-selector [divisions]="phoneBook.organizations"></company-selector>
    </div>

    <div id="app-divisions-content" [ngClass]="{'with-controls': session.user && session.user.isAdministrator}">
        <division-tree [id]="'phone-book-divisions'" [divisions]="phoneBook.divisions" (onSelect)="selectDivision($event)"></division-tree>
    </div>
    <div id="app-division-controls" *ngIf="session.user && session.user.isAdministrator">
        <button type="button"
                class="btn green small round margin-right-10"
                title="Добавить структурное подразделение"
                [disabled]="phoneBook.loading"
                (click)="openNewDivisionModal()">
            <i class="fa fa-plus"></i>
        </button>

        <button type="button"
                class="btn blue small round margin-right-10"
                [disabled]="!phoneBook.selectedDivision || phoneBook.loading"
                title="Редактировать структурное подразделение"
                (click)="openEditDivisionModal()">
            <i class="fa fa-pencil"></i>
        </button>

        <button type="button"
                class="btn red small round"
                [disabled]="!phoneBook.selectedDivision || phoneBook.loading"
                title="Удалить структурное подразделение"
                (click)="openDeleteDivisionModal()">
            <i class="fa fa-times"></i>
        </button>
    </div>
</div>



<div id="app-content-wrapper" [ngClass]="{ 'with-ats': isAtsPanelOpened }">

    <!-- Панель выбора АТС -->
    <div id="app-ats" [ngClass]="{ 'opened': isAtsPanelOpened }">
        <div class="ats">
            <span class="title">Вы звоните из</span>
            <select name="ats" id="ats" [(ngModel)]="phoneBook.selectedAts.id" (change)="selectAts()">
                <option value="{{ 17 }}">Аппарат управления</option>
                <option value="{{ 18 }}">Северные электрические сети</option>
                <option value="{{ 19 }}">Центральные электрические сети</option>
            </select>
        </div>
        <div class="close-button" title="Закрыть" (click)="closeAtsPanel()">&times;</div>
    </div>


    <!-- Содержимое активного раздела приложения -->
    <div id="app-content">
        <router-outlet></router-outlet>
    </div>

</div>


<auth [isOpened]="inAuthMode" (onClose)="closeAuthModal()"></auth>
<user-menu [isOpened]="inUserMenuMode" (onClose)="closeUserMenuModal()"></user-menu>
<edit-contact [isOpened]="phoneBook.selectedContact === 'test'" (onClose)="closeEditContactModal()" [contact]="phoneBook.selectedContact"></edit-contact>


<!-- Модальное окно добавления нового структурного подразделения -->
<modal [id]="'new-division-modal'"
       [title]="'Новое структурное подразделение'"
       [width]="400"
       (onClose)="closeNewDivisionModal(newDivisionForm)">
    <div class="modal-content">
        <form novalidate class="padding-20" #newDivisionForm="ngForm">
            <div class="margin-bottom-10" *ngIf="phoneBook.selectedDivision">
                <label for="new-division-parent">Структурное подразделение верхнего уровня</label>
                <input type="text"
                       name="parent"
                       id="new-division-parent"
                       class="width-100 margin-top-5"
                       placeholder="Структурное подразделение верхнего уровня"
                       [value]="phoneBook.selectedDivision.title"
                       disabled>
            </div>
            <div class="margin-bottom-20">
                <label for="new-division-title">Наименование структурного подразделения</label>
                <input type="text"
                       name="title"
                       id="new-division-title"
                       class="width-100 margin-top-5"
                       placeholder="Введите наименование"
                       [(ngModel)]="newDivision.title"
                       required>
            </div>
            <!--
            <div class="selectable-input margin-bottom-20">
                <div class="value">
                    <input type="checkbox"
                           name="is-department"
                           id="new-division-is-department"
                           [(ngModel)]="newDivision.isDepartment">
                </div>
                <div class="label">Структурное подразделение является производственным отделением</div>
            </div>
            -->
            <div class="width-50 padding-right-5">
                <button type="submit"
                        class="btn green width-100 margin-bottom-10"
                        [disabled]="!newDivisionForm.valid"
                        (click)="addDivision()">
                    Добавить
                </button>
            </div>
            <div class="width-50 padding-left-5">
                <button type="button"
                        class="btn red width-100"
                        (click)="this.modals.close('new-division-modal')">
                    Отмена
                </button>
            </div>
        </form>
    </div>
</modal>


<!-- Модальное окно изменения структурного подразделения -->
<modal [id]="'edit-division-modal'"
       [title]="'Изменение структ. подразделения'"
       [width]="400"
       (onClose)="closeEditDivisionModal(editDivisionForm)"
       *ngIf="phoneBook.selectedDivision">
    <div class="modal-content">
        <form novalidate class="padding-20" #editDivisionForm="ngForm">
            <div class="margin-bottom-10" *ngIf="phoneBook.selectedDivision.parentId !== 0">
                <label for="new-division-parent">Структурное подразделение верхнего уровня</label>
                <input type="text"
                       name="parent"
                       id="selected-division-parent"
                       class="width-100 margin-top-5"
                       placeholder="Структурное подразделение верхнего уровня"
                       [value]="phoneBook.getDivisionById(phoneBook.selectedDivision.parentId).title"
                       disabled>
            </div>
            <div class="margin-bottom-20">
                <label for="new-division-title">Наименование структурного подразделения</label>
                <input type="text"
                       name="title"
                       id="selected-division-title"
                       class="width-100 margin-top-5"
                       placeholder="Введите наименование"
                       [(ngModel)]="phoneBook.selectedDivision.title"
                       required>
            </div>
            <!--
            <div class="selectable-input margin-bottom-20">
                <div class="value">
                    <input type="checkbox"
                           name="is-department"
                           id="new-division-is-department"
                           [(ngModel)]="newDivision.isDepartment">
                </div>
                <div class="label">Структурное подразделение является производственным отделением</div>
            </div>
            -->
            <div class="width-50 padding-right-5">
                <button type="submit"
                        class="btn green width-100 margin-bottom-10"
                        [disabled]="!editDivisionForm.valid || !editDivisionForm.dirty"
                        (click)="editDivision()">
                    Сохранить изменения
                </button>
            </div>
            <div class="width-50 padding-left-5">
                <button type="button"
                        class="btn red width-100"
                        (click)="this.modals.close('edit-division-modal')">
                    Отмена
                </button>
            </div>
        </form>
    </div>
</modal>


<!-- Модальное окно удаления структурного подразделения -->
<modal [id]="'delete-division-modal'"
       [title]="'Удаление структ. подразделения'"
       [width]="400"
       *ngIf="phoneBook.selectedDivision">
    <div class="modal-content">
        <form novalidate class="padding-20">
            <div class="margin-bottom-10" *ngIf="phoneBook.selectedDivision.parentId !== 0">
                Структурное подразделение "{{ phoneBook.selectedDivision.title }}" будет удалено.
            </div>
            <div class="width-50 padding-right-5">
                <button type="submit"
                        class="btn blue width-100 margin-bottom-10"
                        (click)="editDivision()">
                    Удалить
                </button>
            </div>
            <div class="width-50 padding-left-5">
                <button type="button"
                        class="btn red width-100"
                        (click)="this.modals.close('edit-division-modal')">
                    Отмена
                </button>
            </div>
        </form>
    </div>
</modal>



<!-- Модальное окно кадрирования фотографии абонента -->
<modal [id]="'edit-contact-photo-modal'"
       [title]="'Кадрирование фотографии'"
       [width]="500"
       [contentHeight]="400"
(onClose)="modals.close(true)">
    <div class="modal-content">
        <photo-editor
                *ngIf="phoneBook.selectedContact"
                [url]="phoneBook.selectedContact.photo"
                [width]="500"
                [height]="400"
                [frameWidth]="258"
                [frameHeight]="140"
                [frameLeft]="phoneBook.selectedContact.photoLeft"
                [frameTop]="phoneBook.selectedContact.photoTop"
                [zoom]="phoneBook.selectedContact.photoZoom"
                (onSaveChanges)="onChangeContactPhotoPosition($event)">
        </photo-editor>
    </div>
</modal>

